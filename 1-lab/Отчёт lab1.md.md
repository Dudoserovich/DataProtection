# 1-lab
1. Лабораторная работа выполняется на ОС Kali Linux. В работе
используется консоль (терминал). Вызвать ее возможно, например, перейдя
в пункт приложения и найти там терминал.
![[Screenshot_2022-10-06_14_48_08.png]]

2. Предварительно проверьте наличие других учетных записей (не root).
Удалите их. Для исследования файловых объектов вам потребуются еще два
пользователя, учетные записи которых предстоит создать. 
> Введя команду - `sed 's/:..*//' /etc/passwd` можно посмотреть абсолютно всех пользователей (но стоит отметить, что тут присутствуют и пользователи, созданные во время установки некоторых сервисов, в ручную созданы только user1, user2, user3)

![[Screenshot_2022-10-06_14_51_59.png]]
Удалим их вместе с домашними директориями и прочими ненужными папками в /home:
![[Screenshot_2022-10-06_14_58_51.png]]
Добавим 2-ух юзеров (user1, user2) с домашними директориями при помощи команды `useradd --m user`:
![[Screenshot_2022-10-06_15_02_38.png]]
Присваиваем пароль:
![[Screenshot_2022-10-06_15_05_36.png]]

3. Повторите команды п. 2 для создания учетной записи пользователя
user2. Помните, что оба пользователя по умолчанию являются членами одной
группы users.
> Уже создана выше

4. Аналогично откройте третий текстовый терминал и зарегистрируйтесь
как user1.

5. Откройте второй текстовый терминал и зарегистрируйтесь как user2.
> Регистрируемся под созданными пользователями с командной оболочкой zsh (потому что так удобнее, есть подсказки, автодополнения и прочее)

![[Screenshot_2022-10-06_15_09_47.png]]
![[Screenshot_2022-10-06_15_09_52.png]]

6. Основная часть задания выполняется с правами обычных пользователей.
Переходите в первую консоль и используйте права root только при
выполнении соответствующих пунктов задания. Помните, что операционная
система не контролирует действий администратора и ваше ошибочное
действие может привести к краху системы. Ориентируйтесь на характерную
форму приглашения к вводу команд, в котором отражены ранг и имя
пользователя.

7. С правами user1 с помощью команды cd /root попробуйте войти в
каталог суперпользователя. Объясните результат. Затем с помощью команды
ls -la / просмотрите список основных каталогов и укажите, в какие из них
вы имеете право войти.
> На скриншоте ниже видно, что у нас нет прав на переход в /root, вот если бы были права суперпользователя у нашего пользователя... Так как наш пользователь не является суперпользователем, то и c sudo ничего не выйдет.

 ![[Screenshot_2022-10-06_15_20_06 1.png]]
 > По поводу же того, в какие директории мы можем войти, мы можем войти во все директории, кроме /root (так как туда имеет доступ только пользователь root) и даже имеем право на исполнение и для некоторых файлов/директорий имеем права на запись (об этом нам говорят последние 3 символа 1-го столбца). 
 > См. скриншот ниже:
 
 ![[Screenshot_2022-10-06_15_22_23.png]]
 
 8. Проверьте права доступа к домашним каталогам пользователей
_/home/user1_ и _/home/user2_: они должны быть установлены в 755.
![[Screenshot_2022-10-06_15_47_13.png]]
`drwr-xr-xr-x` значит, что это директории и эквивалентно (в численном виде) правам доступа 755.

9. Переключитесь в консоль администратора и создайте два новых
временных каталога:

`mkdir -m 777 /home/temp1` и `mkdir -m 1777 /home/temp2`

![[Screenshot_2022-10-06_15_53_14.png]]
10. Вернитесь в консоль user1 и, пользуясь командой mkdir, создайте в
домашнем каталоге пользователя /home/user1 четыре каталога с именами
qu1, qu2, qu3, qu4. При создании каталогов объявите следующие права
доступа к ним: (qu1 - 777, qu2 - 404, qu3 - 1333, qu4 -- 505). Пример:

`cd; mkdir -m 777 qu1`

С помощью команды ls /home/user1 убедитесь в том, что каталоги созданы.
![[Screenshot_2022-10-06_15_58_21.png]]
Какие из предоставленных прав кажутся вам лишенными смысла? Почему?
> Права для директории /qu2 кажутся лишёнными смысла, потому что пользователь, под которым мы создали эту директорию, может просмотреть содержимое каталога (хоть мы и не увидим полную информацию о файлах из-за отстуствия возможности выполнения), но его группа user1 не может (было бы логичным дать какие-то права и группе user1), а так же не может перейти в указанную директорию. Это возможно только из под sudo, а этот пользователь не может пользоваться sudo. 
> 
> Так же сомнительными являются права доступа для /qu4, потому что у нас нет прав для записи (write).
> 
> Так же немного сомнительные права лоя qu3/, потому что у user1 нет прав на чтение (был создан так называемый "тёмный" каталог (-wx-))

11. Задайте права доступа к файлам «по умолчанию». Для этого установите
маску доступа umask 022. Поясните, какие права к вновь создаваемым
файлам и каталогам будут предоставляться пользователю, членам его группы
и остальным.
![[Screenshot_2022-10-06_16-09-27.png]]
> Мы установили umask 022, а значит:
> - В итоге получим: `644` для файла и `755` для директории
> - Владелец: `rw-` для файла и `rwx` для директории
> - Группа: `r--` для файла и `r-x` для директории
> - Остальные: `r--` для файла и `r-x` для директории

12. В каждом из каталогов создайте по три текстовых файла с именами
(jan, feb, mar), (apr, may, jun), (jul, aug, sep), (oct, nov, dec). В
каждый файл запишите календарь на определенный месяц текущего года. Например, команда `ncal 1 2022 \>jan` создает в текущем каталоге файл _jan_ и записывает в него
календарь на январь 2022 года. Не забывайте, что использование
относительного (короткого) имени файла требует, чтобы вы находились в нужном каталоге. В противном случае следует указывать полный путь к создаваемому файлу. Для навигации по каталогам используйте команды cd и pwd. 
**qu1:**
![[Pasted image 20221007015236.png]]
**qu3:**
![[Pasted image 20221007020613.png]]
В каком случае создание файлов не удалось? Почему?
> Не удалось создать файлы в директории /qu2 и /qu4, причина описана в одном из предыдущих пунктов. В /qu2 у нас нет прав для перехода и просмотра содержимого (точнее право на просмотр как бы есть, но мы не увидим полную информацию о файлах, потому что нет права на исполнение), а в /qu4 для записи.
> **qu2, qu4:**
> ![[Pasted image 20221007020007.png]]

13. С помощью команды chmod установите нужные права доступа в
«недоступные» каталоги qu2, qu4 и создайте там указанные файлы. После
этого верните каталогам прежние права доступа.
![[Screenshot_2022-10-07_02_15_30.png]]
![[Screenshot_2022-10-07_02_17_14.png]]
![[Pasted image 20221007023122.png]]
14. С помощью команд cd и ls войдите в каждый из созданных каталогов и
просмотрите список созданных файлов. При просмотре содержимого каталогов
используйте два режима: ls без аргументов и ls -l. 
**qu1:**
![[Pasted image 20221007021913.png]]
**qu2:**
![[Pasted image 20221007023330.png]]
**qu3:**
![[Pasted image 20221007023439.png]]
**qu4:**
![[Pasted image 20221007023418.png]]
В каких случаях не удалось войти в каталог? В каких случаях не удалось посмотреть список файлов? Почему?
> Не удалось войти в каталог qu2, а так же просмотреть его содержимое. Почему говорил в предыдущих пунктах...  В qu2 у нас нет прав для перехода и просмотра содержимого (точнее право на просмотр как бы есть, но мы не увидим полную информацию о файлах потому что нет права на исполнение)
> 
> Так же не удалось просмотреть содержимое каталога qu3, потому что он является так называемым "тёмным" каталогом.

15. Прочитайте содержимое одного из файлов в «темном» каталоге
(например, `cd /home/user1/qu3; cat aug`). Сделайте выводы.
![[Pasted image 20221007024849.png]]
![[Pasted image 20221007024922.png]]
> Можно сделать вывод, что зная полный путь до файла в "тёмном" каталоге, мы можем просмотреть его содержимое. Посмотреть оглавление же этого каталога не является возможным.

16. Перейдите во 2-ю консоль и с правами пользователя user2 войдите в
каталог /home/user1/qu1. Создайте в каталоге /home/user2 новый файл
quart1 путем конкатенации нескольких имеющихся:

cat jan feb mar \>/home/user2/quart1

С помощью команды file определите тип созданного файла. Попробуйте
вывести его на экран командой cat.
![[Pasted image 20221007030517.png]]
**Что представляет собой данный файл?**
> Файл является результатом конкатинации 3-х файлов jan, feb и mar. Тип файла - ASCII text

17. С помощью команды chmod установите права доступа 077 на созданный
файл quart1. Вновь попробуйте прочесть его. Ответьте, почему владельцу
файла запрещается доступ, если файл доступен для всех? Что необходимо
сделать, чтобы вернуть владельцу права на доступ?
![[Pasted image 20221007030643.png]]
> в праве доступа 077 первая цифра - 0, а это значит, что создатель файла не имеет никаких прав доступа по отношению к данному файлу. Чтобы дать полные права к файлу можно прописать: `chmod u+rwx quart1`. Если же только права на чтение, то `chmod u+r quart1` 

![[Pasted image 20221007031038.png]]

18. Установите для файла quatr1 права на доступ 4700. Кому и какие
права вы при этом предоставили? Как воспользоваться этими правами? Какие
из предоставленных прав не имеют смысла?
![[Pasted image 20221007031228.png]]
> Мы установили права доступа для владельца на чтение и запись, а так же SUID. SUID позволяет запускать обычным пользователям программы от имени супер пользователя. По факту SUID в данном случае не имеет никакого смысла, можно было бы обойтись и обычным выполнением или и вовсе без него. А получились эти права следующим образом: 4=read, 7=write(2)+SUID(5)

19. Перейдите в консоль администратора и передайте право владения на
файлы may и aug пользователю user2 (команда chown). Поочередно из
консолей user1 и user2 проверьте, как изменились права владения файлами
после его передачи. Может ли пользователь user2 воспользоваться
предоставленными правами? (Пользователи user1 и user2 при создании
учетных записей по умолчанию отнесены к одной группе users.)
![[Pasted image 20221007103046.png]]
![[Pasted image 20221007103644.png]]
У меня созданные пользователи изначально не были отнесены к группе users, поэтому пришлось добавить их к этой группе самому:
![[Pasted image 20221007104215.png]]
Проверяем выдались ли права:
![[Pasted image 20221007104617.png]]
> Исходя из этого user2 имеет права read и write над файлами, а user1 теперь имеет только право на чтение.

**user1:**
![[Pasted image 20221007105410.png]]
**user2:**
![[Pasted image 20221007105354.png]]
> user2 может воспользоваться своими права. Так же оба пользователя всё так же не могу никак взаимодействовать с файлами внутри директории qu2 из-за того, что у каталога нет прав на исполнение

20. Правами пользователя user1 из каталогов /home/temp1 и /home/temp2 c
помощью команды ln создайте две «жесткие» ссылки на файл dec с именами
dec_h1 и dec_h2

ln /home/user1/qu4/dec /home/temp1/dec_h1

Чем созданные ссылки отличаются от исходного файла?

![[Pasted image 20221007105923.png]]
> "Жёсткие" ссылки отображаются в файловой системе так же, как и обычные файлы и имеют те же права, что и файл, на который они ссылаются. Однако, это не копия, а указатель на исходный файл (если очень грубо, то можно сказать, что это ещё одно имя файла или же синоним)

21. С помощью команды `ln -s` создайте из каталогов /home/temp1 и
/home/temp2 две символические ссылки на файл dec с именами dec_s1 и
dec_s2. Чем отличаются созданные ссылки от исходного файла? Попытайтесь
прочитать содержимое файлов символических ссылок. Что они собой
представляют?
![[Pasted image 20221007113903.png]]
> Сразу видна разница по сравнению с "жёсткими" ссылками. Во первых, мы чётко видим на какой файл ссылаются созданные ссылки, а во вторых видно, что права доступа для исходного файла и права доступа для символической ссылки разные, т.е. права доступа этого вида ссылок не зависят от прав доступа исходных файлов. 
> 
> Так же можно заметить, что inode у жёсткой ссылки такой же, как и у самого файла, а у символической свой собственный. Это видно из скриншота ниже:

![[Pasted image 20221007114505.png]]
> Вообще, ещё одно отличе этих ссылок в том, что при создании жёсткой ссылки можно менять файл, удалять, переименовывать и ссылка всё ещё останется рабочей, когда символическая ссылка перестанет работать.

22. Правами пользователя user2 с помощью команды cp создайте в
каталогах /home/temp1 и /home/temp2 по одной копии файла dec с другим
именем (dec_copy1). Чем отличаются исходный файл и его копия (обратите
внимание на то, кто является владельцем исходного файла и его копии)?
Чем отличаются права доступа на эти файлы? Вернитесь в консоль user1.
![[Pasted image 20221007115923.png]]
> При копировании файла владельцем нового файла является пользователь, выполняющий команду.

23\. С правами пользователя user1 создайте жесткие ссылки из его
домашнего каталога на файл /bin/su (доступен обычным пользователям
только на исполнение) и на файл /etc/shadow (для обычных пользователей
недоступен).  Какую выгоду получает обладатель жестких ссылок на недоступные файлы?
![[Pasted image 20221007120849.png]]
![[Pasted image 20221007120907.png]]
**Ответьте, какими правами на объектовый файл нужно обладать,
чтобы создать на него жесткую ссылку?**
> Ссылки не удалось создать. Исходя из того, что до этого мы создавали ссылки, имея права только на чтение и запись и того, что сейчас у нас не получилось при правах на чтение и выполнения для /bin/su создать ссылку, можно сделать вывод, что для создания ссылки необходимо обладать правами на запись (write). 

**Какую выгоду получает обладатель жестких ссылок на недоступные файлы?**
> Ссылка будет работать независимо от того переименован, перемещён или удалён файл, однако и права у ссылки меняются так же, как и у исходного файла.

24. С правами пользователя user1 скопируйте в его домашний каталог
утилиту /bin/mount. Сравните между собой оригинал и копию и укажите все
отличия. Сможет ли пользователь применить копию опасной утилиты во вред
политике безопасности? Почему?
![[Pasted image 20221007121830.png]]
> Принципиальное отличие во владельце и группе, а так же во времени создании.

**Сможет ли пользователь применить копию опасной утилиты во вред
политике безопасности? Почему?**
> Не уверен, что правильно понял вопрос, но т.к. владелец уже не root, то мы можем изменять эту утилиту как хотим и даже вшить в неё что-нибудь вредоносное, а после под рутом скопировать обратно и получить как будто бы ту же утилиту, но с вредоносным поведением. Причём т.к. скопируем обратно мы под рутом, то замену легко не заметить. Это как пример и опять же не уверен, что я правильно понял вопрос.

25. С помощью команды rm удалите файл dec. Что произошло с «жесткими» и символическими ссылками на данный файл? Что произошло с его копиями? Что нужно сделать для того, чтобы файл перестал существовать (на логическом уровне)?
![[Pasted image 20221007122750.png]]
![[Pasted image 20221007122854.png]]
> По символической ссылке файла уже не существует, когда по жёсткой он ещё есть.
> 
> Чтобы файл перестал существовать на логическом уровне и мы не имели к нему доступа даже по жёстким ссылкам, нужно удалять файл по его inode.

26. Правами user1 удалите файлы из каталогов /home/temp1 и /home/temp2.
Какие файлы не удалось удалить? Почему? Попробуйте удалить оставшиеся
файлы правами пользователя user2. Объясните результат.
![[Pasted image 20221007123323.png]]
> Возможно я в каком-то пункте ошибся, но удалить файл получилось правами user1. Не получилось бы обычным rm удалить каталог. Ну и возможно имелось ввиду, что есть защищённые от записи файлы, но были только сообщения о том "уверен ли я, что хочу удалить защищённый от записи файл".

27. Попробуйте удалить любой из каталогов qu1, qu2, qu3, qu4 с помощью команды rmdir (не удаляя предварительно из них файлов). Объясните результат.
![[Pasted image 20221007124008.png]]
> rmdir умеет удалять только пустые директории.

28. Войдите в консоль администратора и с правами root, пользуясь командой сhattr, заблокируйте файл feb от любых изменений (предварительно ознакомьтесь с синтаксисом команды). Установите параметр запрета любых операций, кроме добавления данных для файла mar. Вернитесь в консоль user1. С помощью команды lsattr -l проверьте наличие дополнительных атрибутов у файлов.
![[Pasted image 20221007124824.png]]
![[Pasted image 20221007124858.png]]

29. Правами пользователя user1 добавьте одну строку finish в конец файлов feb и mar . Воспользуйтесь для этого командой `echo finish >> file_name`. Убедитесь в успешном завершении операции, объясните результат.
![[Pasted image 20221007125135.png]]
> Первый файл заблокирован, а во второй мы можем добавлять, пожтому во второй мы и смогли добавить строку. 

30. Правами пользователя user1 с помощью команды rm -rf последовательно удалите ранее созданные каталоги qu2, qu3, qu4 вместе с файлами. Объясните результат.
![[Pasted image 20221007125633.png]]
> Каталог qu2 мы не смогли удалить, потому что у нас отсутствует доступ к каталогу на исполнение. Тут только удалять солержимое каталога (или же менять права доступа к каталогу), либо из под sudo сам каталог.
> 
> Каталог qu3 не получилось удалить, потому что права доступа -wx и тут стоит действоать по тому же алгоритму, что и в предыдущей ситуации (в данном случае rm -rf даже не попытался удалить рекурсивно содержимое директории).
> 
> Каталог qu4 не получилось удалить, потому что у нас права только на чтение и выполнение.

31. С правами пользователя user1 создайте в /home/user1 два каталога `mkdir -m 400 src` и `mkdir -m 200 dst`. Внутри каталога src командой `echo 1234567890 > abc` создайте текстовый файл (если для этого прав доступа к каталогу недостаточно, временно измените их). Для созданного файла установите права доступа `chmod 100 abc`.
![[Pasted image 20221007130632.png]]
32. Манипулируя правами доступа на созданные файловые объекты, установите минимально необходимые права, позволяющие копировать и перемещать указанный файл из каталога src в каталог dst. Зафиксируйте результаты в отчете.
![[Pasted image 20221007131621.png]]

33. Определите, какие минимально необходимые права на файловые объекты нужно иметь, чтобы выполнять копирование и перемещение файла от имени администратора.
> По факту, из под sudo можно перемещать и копировать абсолютно любые файлы, которым не даны запрещающие атрибуты с помощью chattr.

34. Понаблюдайте и зафиксируйте в отчете изменения временных отметок файлов и каталогов, происходящие при файловых операциях.
> stat позволяет просматривать все временные метки файла. 
> 
> **atime**
atime означает время доступа. Эта временная метка сообщает вам, когда был последний раз обращались к файлу. При доступе это означает, что если вы использовали cat, vim, less или какой-либо другой инструмент для чтения или отображения содержимого файла.
>
> **mtime**
mtime  означает время модификации. Эта временная метка сообщает вам, когда был последний раз модифицирован файл. Это означает, что содержимое файла было изменено путем редактирования файла.
>
>**ctime**
ctime  означает время изменения статуса. Эта временная метка сообщает вам, когда был последний раз были изменены свойства и метаданные файла. Метаданные включают права доступа, права собственности, имя и местоположение файла.
>
>Ну собственно названия говорят сами за себя когда они меняются.