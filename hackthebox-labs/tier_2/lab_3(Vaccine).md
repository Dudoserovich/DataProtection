## Результат nmap
```
PORT      STATE    SERVICE VERSION
21/tcp    open     ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.45
|      Logged in as ftpuser
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp    open     ssh     OpenSSH 8.0p1 Ubuntu 6ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA)
|   256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA)
|_  256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519)
80/tcp    open     http    Apache httpd 2.4.41 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: MegaCorp Login
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
27355/tcp filtered unknown
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
**Сервисы:** ftp, ssh, apache
На ftp мы видим файл backup, попробуем вытащить его.

## ftp
![[Pasted image 20221205005542.png]]

Чтобы вытащить содержимое архива необходим пароль:
![[Pasted image 20221205005855.png]]
Ну, как говорится брутфорс - наше всё, поэтому используем Джона Потрошителя для подбора пароля:
![[Pasted image 20221205010651.png]]
**zip2jhon** - создаём хэш для архива.
![[Pasted image 20221205010617.png]]

Распаковываем содержимое:
![[Pasted image 20221205010746.png]]

Для отправки формы испольется post запрос:
![[Pasted image 20221205010923.png]]
Ожидается, что логин - `admin`, а пароль это хэш md5(самый херовый выбор если честно), равный строке - `2cb42f8734ea607eefed3b70af13bbd3`.
Дешифровать md5 не составит особых проблем.

Будем использовать hashcat:
![[Pasted image 20221205012816.png]]
Возникли определённые трудности с hashcat на виртуалке, поэтому я попытался сделать тоже самое с wsl Ubuntu:
![[Pasted image 20221205012740.png]]
> Пароль: `qwerty789`

## Сайт
![[Pasted image 20221205005105.png]]

Мы успешно зашли:
![[Pasted image 20221205013018.png]]
Далее можно было бы ручками попробовать внедрить sql инъекцию, но мы же крутые безопасники, попробуем использовать какую-нибудь утилиту (например, **sql map**)

## sql-иъекция
Можно было бы попробовать написать нечто подобное:
![[Pasted image 20221205214849.png]]

Однако, нам ещё нужно авторизоваться.
![[Pasted image 20221205215156.png]]

Из куков имеется только **PHPSESSID**, попробуем использовать его для аутентификации:
![[Pasted image 20221205215718.png]]

Видим, что get параметр подвржен атаке:
![[Pasted image 20221205215910.png]]
Это нам на руку, попробуем получить с помощью sql-инъекции обратную оболочку.

Добавляется всего один флаг в команду и мы уже внутри (`--open-shell`):
![[Pasted image 20221205220058.png]]

![[Pasted image 20221205220231.png]]

Но всё же эта оболочка не очень устойчива и мы хотим получить свою.
Запускаем natcat:
![[Pasted image 20221205220506.png]]

Используем хитроумный скрипт для отправки оболочки:
![[Pasted image 20221205220801.png]]
`-c` - inline mod.
`&>` проверяет открыт ли дескриптор целевого файла для вывода.
`/dev/tcp` является особым случаем bash, он открывает сокет (который затем ведёт себя как обычный дескриптор файла по отношению к вызовам чтения и записи). Сокет позволяет как чтение, так и запись.
`0` -стандартный поток ввода.
`0>&1` перенаправляем стандартный поток ввода на стандартный поток вывода. 
**Соокет** — название программного интерфейса для обеспечения обмена данными между процессами.

![[Pasted image 20221205220933.png]]
// Пояснение к команде

Мы можем пойти дальше и улучшить нашу оболочку (потому что оболочка не стабильна и всё равно вылетает).
![[Pasted image 20221205221335.png]]
Мы использовали python3, всё тот же флаг `-c` для inline режима и библиотеку pty, чтобы получить bash оболочку.

![[Pasted image 20221205221526.png]]
Мне не особо помог питоновский скрипт, который мы использовали и я снова вылетел((

**user flag:** `ec9b13ca4d6229cd5cc1e09980965bf7`

Следующий наш шаг - повышение привелегий.

## Повышение привелегий
Можно попытаться выполнить команду `sudo -l` _(чтобы посмотреть все команды, которые мы можем выполнить)_, но с нас попросят пароль, а пароль стоит какой-то не стандартный:
![[Pasted image 20221205222006.png]]

Чтож, посмотрим содержимое сайта:
![[Pasted image 20221205222231.png]]

И очень просто находим пароль postgres:
![[Pasted image 20221205222405.png]]
**pass postgres:** `P@s5w0rd!`

Попробуем подключиться по ssh к машинке, потому что наша оболочка заколебала помирать:
![[Pasted image 20221205222803.png]]

Следующие двоичные файлы мы можем выполнить ка суперпользователь:
![[Pasted image 20221205222946.png]]
`/bin/vi /etc/postgresql/11/main/pg_hba.conf`

Воспользуемся сайтом, на котором можно посмотреть все стандартные для linux бинарники и как их использовать для повышения привелегий:
![[Pasted image 20221205223400.png]]

![[Pasted image 20221205223619.png]]

Воспользовавшись руководством под буквой b) (открыв файл, который мы можем открыть под рутом и выполнив 2 команды с помощью двоеточия), мы получаем права рута:
![[Pasted image 20221205224215.png]]

![[Pasted image 20221205224355.png]]
**root flag:** `dd6e058e814260bc70e9bbdef2715849`

