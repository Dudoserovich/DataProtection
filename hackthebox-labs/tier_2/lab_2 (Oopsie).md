## Результат nmap
```
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)
|   256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)
|_  256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Welcome
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
У нас имеется `22` порт с ssh и `80` с web-сервером apache.

## Сайт
![[Pasted image 20221204225405.png]]
В тексте присутствует упоминание регистрации, поэтому давайте поищем на страничке какие-ниубдь ссылки на страницу авторизации:
![[VirtualBoxVM_MX7a50eZMN.png]]
> Есть скрипт, которого путь лежит через директорию login: `/cdn-cgi/login/script.js`. Попробуем использовать этот путь.

### Страница авторизации
![[Pasted image 20221204230016.png]]
Подобрать параметры для входа не удалось, но есть ещё кнопка **login with Guest**:
![[Pasted image 20221204230319.png]]
Тут можно вычленить некоторую информацию. К примеру, что некоторые параметры передаются через урл и что у пользователя есть почта с **кастомным доменом** и **access id**.

Добавим на будущее этот домен в `/etc/hosts`
![[VirtualBoxVM_OXTbHuYK0I.png]]
![[Pasted image 20221204225538.png]]

Так же меняя параметр id можно получить других пользователей:
![[Pasted image 20221204230903.png]]

Нашли админа:
![[Pasted image 20221204230955.png]]

Банально подменив куки, мы можем легко получить доступ к страничке uploads:
![[Pasted image 20221204231855.png]]

Будем пытаться загрузить обратную оболочку, возможно через этот загрузщик картинок.
Будем использовать оболочку php, для этого посмотрим, что нам предлагает кали из коробки.

![[VirtualBoxVM_wNSYbcdncp.png]]

Мы видим параметры с пометкой _change this_ (будем менять ip на свой tun и порт по желанию) 
![[VirtualBoxVM_QIjxhZsFuT.png]]

Копируем себе этот файл и меняем ip и порт:
![[Pasted image 20221204232733.png]]
![[Pasted image 20221204232718.png]]
Наша оболочка php готова.

Почему бы тогда не загрузить наш файл на сервер прямо с помощью вкладки uploads?
![[Pasted image 20221204233048.png]]

Теперь нам нужно понять куда сохранился файл и настроить netcat, чтобы запустить код.
Воспользуемся **gobuster**, чтобы посмотреть куда может быть сохранён наш файл.
![[Pasted image 20221204233614.png]]
Из скриншота видно, что есть путь `/uploads`, скорее всего он нам и нужен.

![[Pasted image 20221204233838.png]]
Доступа нет, но может мы сможем воспользоваться обратной оболочкой, если укажем путь прямо до нашего файла.

![[Pasted image 20221204234024.png]]
![[Pasted image 20221204234204.png]]

И да, у нас получилось:
![[Pasted image 20221204234233.png]]

## Шаримся по тачке
![[Pasted image 20221204234747.png]]
Есть некий пользователь robert с оболочкой `/bin/bash`, попробуем для начала подняться до него (обычного пользователя).

Всё оказалось очень просто и у нас есть флаг пользователя:
![[Pasted image 20221204235012.png]]
user flag: `f2c74ee8db7983851ab2a96a44eb7981`

Поищем теперь что-нибудь интересное в корне сайта:
![[Pasted image 20221204235351.png]]

![[Pasted image 20221204235521.png]]

mysqli_connect('localhost','robert','M3g4C0rpUs3r!','garage');

Заходим под Робертом:
![[Pasted image 20221204235704.png]]

![[Pasted image 20221204235911.png]]

Проверяем наши права, видим интерсную группу bugtracker и находим одноимённый бинарник, который проверяем на возможность запуска:
![[Pasted image 20221205000238.png]]
Так же у этого бинарника стоит suid (т.е. он всегда запускается от имени администратора)

![[Pasted image 20221205000418.png]]
С нас требуют какой-то Bug ID и похоже это просто команда cat. 
Похоже, что команда читает отчёты об ошибках.

Создадим в /tmp файл и закинем путь /tmp в $PATH:
![[Pasted image 20221205001133.png]]

![[Pasted image 20221205001424.png]]

**Что произошло?**
Исполнился наш файл с содержимым `/bin/sh`
Так используется cat, то мы просто прокинули наш собственный cat в $PATH и поэтому вызывается в первую очередь именно он.

И так как выполнился наш псевдо скрипт, то мы и сидим в нашей директории:
![[Pasted image 20221205001725.png]]

Ищем root flag:
![[Pasted image 20221205001801.png]]
`af13b0bee69f8a877c3faf667f7beacf`